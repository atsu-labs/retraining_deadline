# 再講習受講期日確認くん

防火・防災管理講習の再講習期限を計算・確認するための Web アプリケーションです。消防法施行規則に基づき、甲種防火管理再講習および防災管理再講習の受講期限を正確に算出します。

## 🚀 主な機能

- **防火管理講習の期限計算**: 甲種防火管理再講習の受講期限を自動計算
- **防災管理講習の期限計算**: 防災管理再講習の受講期限を自動計算
- **附則 2 号特例の自動判定**: 防火管理講習の期限延長特例を自動適用
- **和暦・西暦の両方に対応**: 日付入力は和暦（元号）・西暦の双方向変換に対応
- **視覚的なタイムライン表示**: 期限までの期間や重要な日付を視覚的に確認
- **期限ステータス表示**: 残り日数に応じた警告表示（正常/警告/緊急/期限超過）

## 📋 法的根拠

このアプリケーションは以下の告示に基づいて計算を行います：

- **甲種防火管理再講習について定める件**（平成 16 年消防庁告示第 2 号）
- **防災管理再講習について定める件**（平成 20 年消防庁告示第 17 号）
- **甲種防火管理再講習について定める件等の一部を改正する件**（平成 23 年消防庁告示第 8 号）

詳細は[kokuji.md](./kokuji.md)を参照してください。

## 🛠️ 技術スタック

- **HTML5/CSS3**: レスポンシブな UI デザイン
- **JavaScript (ES6+)**: モジュール形式でのロジック実装
- **Pure.css**: 軽量 CSS フレームワーク
- **vis-timeline**: タイムライン可視化ライブラリ
- **Jest**: ユニットテスト

## 📦 セットアップ

### 必要要件

- Node.js（テスト実行のため）
- モダンブラウザ（Chrome, Firefox, Safari, Edge 等）

### インストール

```bash
# リポジトリをクローン
git clone https://github.com/atsu-labs/retraining_deadline.git
cd retraining_deadline

# 依存パッケージをインストール（テスト実行用）
npm install
```

### 使用方法

#### ブラウザで直接開く

1. `index.html`をブラウザで開く
2. 必要な日付を入力：
   - **選任日**: 防火管理者または防災管理者に選任された日
   - **防火管理講習最終受講日**: 甲種防火管理講習を最後に受講した日
   - **防災チェック**: 防災管理も確認する場合は ON にする
   - **防災管理講習受講日**: 防災管理講習を受講した日（防災チェック ON 時）
3. 「確認」ボタンをクリック
4. 受講期限と詳細情報が表示されます

#### ローカルサーバーで実行

```bash
# Python 3の場合
python -m http.server 8000

# または、Node.jsのhttp-serverを使用
npx http-server
```

ブラウザで`http://localhost:8000`にアクセスしてください。

## 🧪 テスト

```bash
# すべてのテストを実行
npm test

# ウォッチモードでテスト実行
npm run test:watch

# カバレッジレポート付きでテスト実行
npm run test:coverage
```

## 📂 プロジェクト構造

```
retraining_deadline/
├── index.html              # メインHTML
├── test-wareki.html        # 和暦テストページ
├── package.json            # npmパッケージ設定
├── jest.config.js          # Jestテスト設定
├── README.md               # このファイル
├── AGENTS.md               # AI駆動開発ガイドライン
├── kokuji.md               # 法令告示の全文
├── js/
│   ├── script.js           # メインロジック
│   ├── dateUtils.js        # 日付処理ユーティリティ
│   ├── dateUtils.test.js   # dateUtilsのテスト
│   └── fusoku2.test.js     # 附則2号のテスト
├── css/
│   ├── style.css           # メインスタイル
│   └── timeline-custom.css # タイムラインカスタムスタイル
└── coverage/               # テストカバレッジレポート（生成後）
```

## 📖 主要な計算ロジック

### 防火管理講習の期限計算

1. **選任日の 4 年前を計算**
2. **防火受講日と比較**：
   - 選任日の 4 年前より**後**に受講 → 防火受講日の次の 4 月 1 日から 5 年以内
   - 選任日の 4 年前より**前**に受講 → 選任日から 1 年以内

### 防災管理講習の期限計算

1. **選任日の 4 年前を計算**
2. **防災受講日と比較**：
   - 選任日の 4 年前より**後**に受講 → 防災受講日の次の 4 月 1 日から 5 年以内
   - 選任日の 4 年前より**前**に受講 → 選任日から 1 年以内

### 附則 2 号特例

防災管理新規講習修了者が防火管理者を兼ねる場合、以下の条件で特例が適用されます：

- 防火管理が 5 年ルール（選任日が防火受講日から 4 年以内）で計算されている
- 防災管理講習受講日が防火管理講習受講日より後
- 防火期限が防災期限より早い

この場合、防火管理の期限が防災管理新規講習の次の 4 月 1 日から 5 年に延長されます。

## 🎨 UI の特徴

- **レスポンシブデザイン**: デスクトップ・タブレット・モバイルに対応
- **和暦入力サポート**: 令和、平成、昭和などの元号での入力が可能
- **リアルタイム変換**: 和暦 ⇔ 西暦を自動変換
- **視覚的フィードバック**: 期限の緊急度に応じた色分け表示
- **詳細な計算過程**: 折りたたみ可能な計算詳細表示

## ⚠️ 注意事項

- このアプリケーションは参考情報として提供されており、正式な法的判断を代替するものではありません
- 実際の受講期限については、所轄の消防署または講習実施機関にご確認ください
- 法改正等により計算ロジックが変更される可能性があります

## 📝 ライセンス

ISC

## 🤝 コントリビューション

バグ報告や機能提案は Issue でお願いします。プルリクエストも歓迎します。

## 📧 お問い合わせ

質問や提案がある場合は、GitHub の Issue でお知らせください。
